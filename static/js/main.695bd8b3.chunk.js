(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{200:function(e,t,a){},201:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(72),i=a.n(o),l=a(31),s=a(22),c=a(33),u=a(7),d=a(8),p=a(10),h=a(9),m=a(3),b=a(11),f=a(18),v=a.n(f),j=a(15),g=a.n(j),y=a(75),E=a.n(y),w=a(76),C=a.n(w),k=a(4),O=a(2),_=a(77),S=a.n(_),P=a(78),L=a.n(P);function x(){var e=Object(k.a)(["\n  margin-top: 7rem;\n  max-width: 40rem;\n"]);return x=function(){return e},e}var I=O.default.div(x()),F=function(){return r.a.createElement("div",null,r.a.createElement("h1",{style:{textAlign:"center"}},"Hello (Prospective) Partner!"),r.a.createElement("p",null,"This is a quick demo to showcase Partner User Types. Feature extraction and data labelling are hot topics, so imagine you're building a product to create data labels (manually for now). There are two personas:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Labelers: people drawing features to train models"),r.a.createElement("li",null,"Managers: people monitoring the status of labelling projects")),r.a.createElement("p",null,"Log in to explore the experiences for these two personas! "))},D=function(e){var t=e.onClick;return r.a.createElement(I,null,r.a.createElement(L.a,null,r.a.createElement(F,null),r.a.createElement("div",{style:{textAlign:"center",marginTop:"2rem"}},r.a.createElement(g.a,{half:!0,clear:!0,large:!0,onClick:t},"Log In"))))},T=function(){return r.a.createElement(I,null,r.a.createElement(S.a,null))},A=a(32),M=function(e){return e.title.replace("Edit","")},N="https://www.arcgis.com/sharing",H={url:"https://js.arcgis.com/4.12/"},B=a(16),q=a(205);B.c.global.legend=!1,B.c.global.tooltips.enabled=!1;var U={returnGeometry:!1,returnDistinctValues:!1,returnIdsOnly:!1,returnCountOnly:!1,outFields:"*"},Z=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={labelData:{},userData:{}},a}return Object(b.a)(t,e),Object(d.a)(t,[{key:"_updateTimeSeriesDataset",value:function(e){var t=this,a=Object(s.a)({},U,{url:"".concat(e,"/0"),where:"1=1",groupByFieldsForStatistics:"CAST(CreationDate as DATE)",outStatistics:[{statisticType:"count",onStatisticField:"CreationDate",outStatisticFieldName:"total_labels"}],orderByFields:"CAST(CreationDate as DATE)",sqlFormat:"standard",params:{token:this.props.token}});Object(q.a)(a).then(function(e){var a=e.features.reduce(function(e,t){e.data.push(t.attributes.total_labels);var a=new Date(t.attributes.EXPR_1);return e.labels.push("".concat(a.getMonth()+1,"/").concat(a.getDay()+1)),e},{labels:[],data:[]}),n={labels:a.labels,datasets:[{label:"Label Counts",fill:!1,data:a.data,borderColor:"#56a5d8",backgroundColor:"#56a5d8"}]};t.setState({labelData:n})})}},{key:"_updateUserDataset",value:function(e){var t=this,a=Object(s.a)({},U,{url:"".concat(e,"/0"),where:"1=1",groupByFieldsForStatistics:"Creator",outStatistics:[{statisticType:"count",onStatisticField:"Creator",outStatisticFieldName:"creator_counts"}],orderByFields:"creator_counts DESC",sqlFormat:"standard",params:{token:this.props.token}});Object(q.a)(a).then(function(e){var a=e.features.reduce(function(e,t){return e.data.push(t.attributes.creator_counts),e.labels.push(t.attributes.Creator),e},{labels:[],data:[]}),n={labels:a.labels,datasets:[{label:"Label Counts",fill:!1,data:a.data,borderColor:"#56a5d8",backgroundColor:"#56a5d8"}]};t.setState({userData:n})})}},{key:"componentDidUpdate",value:function(e){this.props.project&&(e.project&&e.project.id===this.props.project.id||(this._updateTimeSeriesDataset(this.props.project.url),this._updateUserDataset(this.props.project.url)))}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h3",{style:{marginTop:0}},"Activity"),r.a.createElement("h5",{style:{margin:"0px"}},"Over Time"),r.a.createElement(B.b,{data:this.state.labelData,height:159,options:{scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Label Count"},ticks:{beginAtZero:!0}}]}}}),r.a.createElement("h5",{style:{margin:"0px"}},"By User"),r.a.createElement(B.a,{data:this.state.userData,height:159,options:{scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Label Count"},ticks:{beginAtZero:!0}}]}}}))}}]),t}(n.Component),z={type:"simple",symbol:{type:"simple-marker",size:12,style:"square",color:[76,129,205,191],outline:{width:1,color:[0,0,0,255]}}},R={type:"simple",symbol:{type:"simple-fill",color:[76,129,205,191],outline:{width:1,color:[0,0,0,255]}}},W=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e,a))).loadedModules={},n._onEditSync=n._onEditSync.bind(Object(m.a)(n)),n._onZoomChange=n._onZoomChange.bind(Object(m.a)(n)),n._chartRef=r.a.createRef(),n}return Object(b.a)(t,e),Object(d.a)(t,[{key:"_onEditSync",value:function(e,t,a,n){!e&&t&&this.props.onProjectEdited(this.props.project)}},{key:"_onZoomChange",value:function(e,t){this.lyr&&(e>17&&t<17?this.lyr.renderer=R:e<17&&t>17&&(this.lyr.renderer=z))}},{key:"componentDidMount",value:function(){var e=this;Object(A.loadModules)(["esri/views/MapView","esri/Map","esri/widgets/LayerList","esri/widgets/Editor","esri/layers/ImageryLayer","esri/layers/FeatureLayer","esri/core/watchUtils"],H).then(function(t){var a=Object(c.a)(t,7),n=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=a[6];e.loadedModules={FeatureLayer:s,Editor:i};var d=new l({url:"https://naip.arcgis.com/arcgis/rest/services/NAIP/ImageServer",title:"NAIP Imagery - Natural Color",popupEnabled:!1}),p=new l({portalItem:{id:"e4da3b6720f545aeaaf3fe8141da1e21"},title:"NAIP Imagery - Color Infrared",visible:!1,popupEnabled:!1}),h=new l({portalItem:{id:"aa9c87d6f17b452296252bd75005f6a4"},title:"NAIP Imagery - NDVI",visible:!1,popupEnabled:!1});e.map=new r({basemap:"gray-vector",layers:[h,p,d]}),e.view=new n({container:"mapview",map:e.map,center:[-117.18296,34.05738],zoom:11,constraints:{snapToZoom:!1}}),e.view.when(function(t){var a=new o({view:e.view});if(e.view.ui.add(a,"bottom-right"),e.scaleHandler=e.view.watch("zoom",e._onZoomChange),e.props.isEditor){var n=new i({view:e.view,label:"Create and edit labels"});e.view.ui.add(n,"top-right"),e.watchHandler=u.watch(n.viewModel,"syncing",e._onEditSync)}}).catch(function(e){return console.log(e)})})}},{key:"_addLayerFromProps",value:function(){var e=this,t=this.loadedModules;if(t.FeatureLayer){var a=this.view.zoom>17?R:z;this.lyr=new t.FeatureLayer({portalItem:{id:this.props.project.id},title:M(this.props.project),renderer:a}),this.map.add(this.lyr),this.lyr.queryExtent({where:"1=1"}).then(function(t){t.count>0?e.view.goTo(t.extent):e.view.goTo(e.lyr.fullExtent)})}}},{key:"componentDidUpdate",value:function(e){this.props.project&&(e.project?e.project.id!==this.props.project.id&&(this.map.remove(this.lyr),this._addLayerFromProps()):this._addLayerFromProps())}},{key:"componentWillUnmount",value:function(){this.watchHandler&&this.watchHandler.remove(),this.scaleHandler&&this.scaleHandler.remove(),this.view.ui.remove(this._chartRef.current)}},{key:"render",value:function(){var e=this.props.project&&!this.props.isEditor?"":"none",t=r.a.createElement("div",{ref:this._chartRef,style:{display:e,position:"absolute",top:"80px",right:"15px",width:"280px",height:"380px",padding:"10px",background:"white",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"}},r.a.createElement(Z,{project:this.props.project,token:this.props.token}));return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"mapview",style:{width:"100%",maxHeight:"100%",flexGrow:1}}),t)}}]),t}(n.Component),J=a(34),V=a.n(J);function G(){var e=Object(k.a)(["\n  background: #9bc19c;\n  height: 100%;\n  width: ","%;\n  border-radius: inherit;\n  transition: width .2s ease-in;\n"]);return G=function(){return e},e}function X(){var e=Object(k.a)(["\n  position: relative;\n  height: 20px;\n  width: 100%px;\n  border: 1px solid #959595;\n"]);return X=function(){return e},e}var $=O.default.div(X()),K=O.default.div(G(),function(e){return e.width}),Q=function(e){var t=e.percentage;e.rightLabel;return r.a.createElement($,null,r.a.createElement(K,{width:t}))},Y=a(80),ee=a.n(Y),te=a(81),ae=a.n(te);function ne(){var e=Object(k.a)(["\n  border: ","\n"]);return ne=function(){return e},e}function re(){var e=Object(k.a)(["\n  margin: 0;\n  float: right;\n"]);return re=function(){return e},e}function oe(){var e=Object(k.a)(["\n  margin: 0 !important;\n"]);return oe=function(){return e},e}function ie(){var e=Object(k.a)(["\n  margin: 0 !important;\n"]);return ie=function(){return e},e}function le(){var e=Object(k.a)(["\n  width: calc(100% - 2.5rem)\n"]);return le=function(){return e},e}function se(){var e=Object(k.a)(["\n  position: absolute;\n  top: 12px;\n  right: 16px;\n  padding: 4px;\n"]);return se=function(){return e},e}var ce=Object(O.default)(g.a)(se()),ue=Object(O.default)(J.CardTitle)(le()),de=Object(O.default)(ee.a)(ie()),pe=Object(O.default)(ae.a)(oe()),he=O.default.div(re()),me=Object(O.default)(V.a)(ne(),function(e){return e.selected?"1px solid #0079c1":""}),be=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e,a)))._onClick=n._onClick.bind(Object(m.a)(n)),n}return Object(b.a)(t,e),Object(d.a)(t,[{key:"_onClick",value:function(){this.props.onClick(this.props.project)}},{key:"render",value:function(){var e=this.props.isEditor?r.a.createElement(de,null):r.a.createElement(pe,{size:20});return r.a.createElement(ce,{onClick:this._onClick,small:!0,clear:!0,icon:e})}}]),t}(n.PureComponent),fe=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e,a))).portal=e.portal,n._getProjectCard=n._getProjectCard.bind(Object(m.a)(n)),n._onProjectSelected=n._onProjectSelected.bind(Object(m.a)(n)),n.state={projects:[],selectedId:null},n}return Object(b.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.portal.queryItems({query:"access:shared",sortField:"created",sortOrder:"asc",num:20}).then(function(t){var a=t.results.reduce(function(e,t){var a=t.tags.find(function(e){return e.includes("__nfeatures:")});if(!a)return e;var n=parseInt(a.replace("__nfeatures:",""));return e[t.id]={max:n},e},{});a.projects=t.results,e.setState(a),e.props.onProjectsLoaded(t.results)})}},{key:"_onProjectSelected",value:function(e){this.setState({selectedId:e.id}),this.props.onProjectSelected(e)}},{key:"_getProjectCard",value:function(e,t){var a=M(e),n=this.state[e.id]?this.state[e.id].max:void 0,o=this.props.labelCounts[e.id]?this.props.labelCounts[e.id].count:void 0,i=void 0!==n&&void 0!==o?Math.ceil(o/n*100):0,l=n?n.toString():"--",s=o?o.toString():"--";return r.a.createElement(me,{selected:e.id===this.state.selectedId,key:e.id,style:{maxWidth:"20rem",marginBottom:"1rem"}},r.a.createElement(J.CardContent,null,r.a.createElement(ue,null,a),r.a.createElement(be,{project:e,onClick:this._onProjectSelected,isEditor:this.props.isEditor}),r.a.createElement(Q,{percentage:i}),r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(he,null,s,"/",l," features"))))}},{key:"render",value:function(){var e=this.state.projects.map(this._getProjectCard);return r.a.createElement("div",{style:{width:"25rem",padding:"1rem",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"}},r.a.createElement("h3",{style:{marginTop:0}},"Projects"),e)}}]),t}(n.PureComponent),ve=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e,a))).esriId=null,n._onSignInClick=n._onSignInClick.bind(Object(m.a)(n)),n._onSignOutClick=n._onSignOutClick.bind(Object(m.a)(n)),n._onProjectSelected=n._onProjectSelected.bind(Object(m.a)(n)),n._fetchLabelCountForProject=n._fetchLabelCountForProject.bind(Object(m.a)(n)),n.onProjectsLoaded=n.onProjectsLoaded.bind(Object(m.a)(n)),n.onProjectEdited=n.onProjectEdited.bind(Object(m.a)(n)),n.state={esriLoaded:!1,user:null,project:null,labelCounts:{}},n}return Object(b.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;Object(A.loadModules)(["esri/identity/OAuthInfo","esri/identity/IdentityManager","esri/portal/Portal","esri/layers/FeatureLayer"],H).then(function(t){var a=Object(c.a)(t,4),n=a[0],r=a[1],o=a[2],i=a[3];e.loadedModules={FeatureLayer:i};var l=new n({appId:"4Je20Hog0H13ZgXI"});e.esriId=r,e.esriId.registerOAuthInfos([l]),e.portal=new o,e.esriId.checkSignInStatus(N).then(function(t){return console.log("EFFIN HERE"),e.portal.load()}).then(function(t){var a=!!e.portal.user.privileges.find(function(e){return"features:user:edit"===e});e.setState({esriLoaded:!0,user:e.portal.user.fullName,token:e.portal.credential.token,isEditor:a})}).catch(function(t){"identity-manager:not-authenticated"===t.name?e.setState({esriLoaded:!0,user:null,token:null,isEditor:null}):console.log(t)})})}},{key:"_fetchLabelCountForProject",value:function(e){var t=this;new(0,this.loadedModules.FeatureLayer)({url:e.url}).queryFeatureCount({where:"1=1"}).then(function(a){var n=Object(s.a)({},t.state.labelCounts,Object(l.a)({},e.id,{count:a}));t.setState({labelCounts:n})})}},{key:"onProjectsLoaded",value:function(e){e.forEach(this._fetchLabelCountForProject)}},{key:"onProjectEdited",value:function(e){this._fetchLabelCountForProject(e)}},{key:"_onSignInClick",value:function(){this.esriId.getCredential(N)}},{key:"_onSignOutClick",value:function(){this.esriId.destroyCredentials(),this.setState({esriLoaded:!0,user:null,token:null,isEditor:null})}},{key:"_onProjectSelected",value:function(e){this.setState({project:e})}},{key:"render",value:function(){var e;e=this.state.esriLoaded?this.state.user?r.a.createElement(r.a.Fragment,null,r.a.createElement(fe,{portal:this.portal,onProjectSelected:this._onProjectSelected,labelCounts:this.state.labelCounts,onProjectsLoaded:this.onProjectsLoaded,isEditor:this.state.isEditor}),r.a.createElement(W,{project:this.state.project,onProjectEdited:this.onProjectEdited,isEditor:this.state.isEditor,token:this.state.token})):r.a.createElement(D,{onClick:this._onSignInClick}):r.a.createElement(T,null);var t=this.state.user?r.a.createElement(g.a,{white:!0,icon:r.a.createElement(E.a,{size:25}),iconPosition:"after",onClick:this._onSignOutClick},this.state.user):null;return r.a.createElement("div",null,r.a.createElement(v.a,null,r.a.createElement(f.TopNavBrand,{src:C.a}),r.a.createElement(f.TopNavTitle,null,"Label App"),r.a.createElement(f.TopNavList,null),r.a.createElement(f.TopNavActionsList,null,t)),r.a.createElement("div",{style:{width:"100vw",height:"calc(100vh - 4rem)",display:"flex",justifyContent:"center"}},e))}}]),t}(r.a.PureComponent),je=a(30),ge=a.n(je);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(200);i.a.render(r.a.createElement(ge.a,null,r.a.createElement(ve,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},76:function(e,t,a){e.exports=a.p+"static/media/logo.22dcb7aa.svg"},84:function(e,t,a){e.exports=a(201)}},[[84,1,2]]]);
//# sourceMappingURL=main.695bd8b3.chunk.js.map